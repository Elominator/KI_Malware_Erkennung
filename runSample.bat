@echo off
setlocal enabledelayedexpansion

REM Check if an argument is provided
if "%~1"=="" (
    echo Please provide the path to the executable as an argument.
    exit /b 1
)

REM Check if the file exists
if not exist "%~1" (
    echo The specified file does not exist.
    exit /b 1
)

REM Delete the Directory .\data recursively
if exist ".\data" (
    rmdir /s /q ".\data"
)

REM Create the Directory .\data\exe\cleanware
mkdir ".\data\exe\cleanware"

REM Copy the executable to the created folder
copy "%~1" ".\data\exe\cleanware"

REM Execute the PowerShell script and wait for it to finish
"C:\Program Files\PowerShell\7\pwsh.exe" -ExecutionPolicy Bypass -File ".\automate.ps1"

REM Get the filename of the one and only file in .\Run\data\encoded
for /f "delims=" %%i in ('dir /b ".\data\encoded"') do set "encoded_file=%%i"

REM Execute the Python script with the required arguments
python ".\runInference.py" ".\t_model.pth" ".\data\encoded\!encoded_file!"

REM Keep the window open after execution
pause